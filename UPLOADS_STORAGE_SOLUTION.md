# üóÇÔ∏è –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ß–ò–°–¢–ö–ò –ü–ê–ü–ö–ò UPLOADS

**–î–∞—Ç–∞:** 27 —è–Ω–≤–∞—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞–ø–∫–∞ `/uploads` –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–¥–µ–ø–ª–æ–µ –Ω–∞ Render –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö –≤—Ä–æ–¥–µ Render, Heroku –∏ –¥—Ä—É–≥–∏—Ö PaaS-—Å–µ—Ä–≤–∏—Å–∞—Ö —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —è–≤–ª—è–µ—Ç—Å—è **—ç—Ñ–µ–º–µ—Ä–Ω–æ–π** (ephemeral). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:

- ‚úÖ –§–∞–π–ª—ã, –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚ùå –§–∞–π–ª—ã, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, **—É–¥–∞–ª—è—é—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–¥–µ–ø–ª–æ–µ
- ‚ùå –ü–∞–ø–∫–∞ `app/static/uploads/` –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ

## üí° –†–µ—à–µ–Ω–∏—è

### 1. **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç–µ Base64** ‚≠ê (–í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –≤ WebP
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ë–î
- ‚ùå –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 2. **Persistent Disk –Ω–∞ Render** üí∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- ‚úÖ –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω ($7+/–º–µ—Å—è—Ü)
- ‚ùå –û—Ç–∫–ª—é—á–∞–µ—Ç zero-downtime deploys
- ‚ùå –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 3. **–í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/Cloudinary)** üåê

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ CDN –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ base64:

```sql
-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
ALTER TABLE inventory ADD COLUMN image_data TEXT;
ALTER TABLE inventory ADD COLUMN image_filename VARCHAR(255);
ALTER TABLE inventory ADD COLUMN image_size INTEGER;

-- –ë—é–¥–∂–µ—Ç (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã)
ALTER TABLE budget ADD COLUMN screenshot_data TEXT;
ALTER TABLE budget ADD COLUMN screenshot_filename VARCHAR(255);
ALTER TABLE budget ADD COLUMN screenshot_size INTEGER;
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ `FileManager`:**
- `save_inventory_image_to_base64()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64
- `save_screenshot_to_base64()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ base64
- `get_image_data_url()` - —Å–æ–∑–¥–∞–µ—Ç data URL –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `get_image_size_mb()` - –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞–∑–º–µ—Ä base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –≤ WebP —Ñ–æ—Ä–º–∞—Ç
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞: 800x600 –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, 1920x1080 –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- –ö–∞—á–µ—Å—Ç–≤–æ: 90% –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, 85% –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–π (base64), —Ç–∞–∫ –∏ —Å—Ç–∞—Ä—ã–π (—Ñ–∞–π–ª—ã) —Ñ–æ—Ä–º–∞—Ç:

```html
{% set has_image = item.image_data or item.image_path %}
{% if has_image %}
    {% if item.image_data %}
        <!-- –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: base64 –∏–∑ –ë–î -->
        <img src="data:image/webp;base64,{{ item.image_data }}">
    {% elif item.image_path %}
        <!-- –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç: —Ñ–∞–π–ª -->
        <img src="{{ item.image_path }}">
    {% endif %}
{% endif %}
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–æ–∑–¥–∞–Ω VIEW –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```sql
SELECT * FROM image_storage_stats;
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π —Å base64 –¥–∞–Ω–Ω—ã–º–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π —Å —Ñ–∞–π–ª–∞–º–∏
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä base64 –¥–∞–Ω–Ω—ã—Ö
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
psql $DATABASE_URL -f migration_add_image_base64_fields.sql
```

### 2. –î–µ–ø–ª–æ–π –∫–æ–¥–∞

```bash
git add .
git commit -m "feat: Add base64 image storage to solve uploads cleanup issue"
git push origin main
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–∑–Ω–æ—Å —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–¥–µ–ø–ª–æ–π –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–ø–∞–ª–∏

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –§–æ—Ç–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è: ~50-150 KB (WebP, 800x600, 90%)
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã: ~100-300 KB (WebP, 1920x1080, 85%)

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ë–î:**
- Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ ~33%
- –¢–∏–ø–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: 100 KB ‚Üí 133 KB –≤ base64
- 100 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚âà 13 MB –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ –ë–î

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ –ë–î:

```python
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑)
import base64
from app.database import SessionLocal
from app.models.models import Inventory, Budget
from app.file_manager import FileManager

db = SessionLocal()
file_manager = FileManager()

# –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
for item in db.query(Inventory).filter(Inventory.image_path.isnot(None)).all():
    try:
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64
        with open(f"app/static{item.image_path}", "rb") as f:
            image_data = base64.b64encode(f.read()).decode('utf-8')
            item.image_data = image_data
            item.image_filename = item.image_path.split('/')[-1]
        db.commit()
        print(f"Migrated: {item.item_name}")
    except Exception as e:
        print(f"Error migrating {item.item_name}: {e}")

db.close()
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–µ–ø–ª–æ–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è
- –ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–í—Å–µ –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64.** 