# üïí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–Ø UPDATED_AT

**–î–∞—Ç–∞:** 30 –∏—é–Ω—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** SQLAlchemy –ø—ã—Ç–∞–ª—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å `updated_at` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `None`

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
[parameters: {..., 'updated_at': None}]
```

SQLAlchemy –ø—ã—Ç–∞–ª—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å `updated_at` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `None` –≤ INSERT –∑–∞–ø—Ä–æ—Å, –Ω–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–∂–∏–¥–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–í –º–æ–¥–µ–ª—è—Ö SQLAlchemy –ø–æ–ª–µ `updated_at` –±—ã–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ —Å `onupdate=func.now()`, –Ω–æ –±–µ–∑ `server_default`:

```python
# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
updated_at = Column(DateTime(timezone=True), onupdate=func.now())
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ:
- –ü—Ä–∏ UPDATE - –ø–æ–ª–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚úÖ
- –ü—Ä–∏ INSERT - SQLAlchemy –ø–µ—Ä–µ–¥–∞–µ—Ç `None` ‚ùå

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ SQLAlchemy

**–§–∞–π–ª—ã:** `app/models/models.py`

```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now())
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏:**
- `Budget` - —Ç–∞–±–ª–∏—Ü–∞ budget
- `Inventory` - —Ç–∞–±–ª–∏—Ü–∞ inventory  
- `BudgetType` - —Ç–∞–±–ª–∏—Ü–∞ budget_types
- `InventoryItemType` - —Ç–∞–±–ª–∏—Ü–∞ inventory_item_types
- `InventoryMaterialType` - —Ç–∞–±–ª–∏—Ü–∞ inventory_material_types

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `fix_updated_at_defaults.sql`

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º DEFAULT NOW() –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE inventory ALTER COLUMN updated_at SET DEFAULT NOW();
ALTER TABLE budget ALTER COLUMN updated_at SET DEFAULT NOW();
ALTER TABLE budget_types ALTER COLUMN updated_at SET DEFAULT NOW();
ALTER TABLE inventory_item_types ALTER COLUMN updated_at SET DEFAULT NOW();
ALTER TABLE inventory_material_types ALTER COLUMN updated_at SET DEFAULT NOW();
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø–æ–ª–µ `updated_at`:
- ‚úÖ **–ü—Ä–∏ INSERT** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- ‚úÖ **–ü—Ä–∏ UPDATE** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- ‚úÖ **SQLAlchemy –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç** –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∑–∞–ø—Ä–æ—Å–µ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DEFAULT

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```bash
psql $DATABASE_URL -f fix_updated_at_defaults.sql
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö SQLAlchemy —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∑–Ω–æ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç `updated_at`
4. ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ —Å `updated_at: None`

## üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `app/models/models.py` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –º–æ–¥–µ–ª–∏ —Å `updated_at`
- `fix_updated_at_defaults.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ë–î

## üéâ –°—Ç–∞—Ç—É—Å

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ `updated_at`. 