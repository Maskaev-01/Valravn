# üá∑üá∫ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–£–°–°–ö–ò–• –ò–ú–ï–ù –í VK –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

**–î–∞—Ç–∞:** 30 –∏—é–Ω—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK –∏–º–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK ID SDK –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –≤–º–µ—Å—Ç–æ —Ä—É—Å—Å–∫–æ–≥–æ:
- `first_name`: "Vladimir" –≤–º–µ—Å—Ç–æ "–í–ª–∞–¥–∏–º–∏—Ä"  
- `last_name`: "Ivanov" –≤–º–µ—Å—Ç–æ "–ò–≤–∞–Ω–æ–≤"

## üîç –ü—Ä–∏—á–∏–Ω–∞

1. **VK ID SDK –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞**
2. **VK API –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `lang=ru` —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞**
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–≤–∞–ª—Å—è –¥–∞–Ω–Ω—ã–º –∏–∑ SDK, –∞ –Ω–µ –∏–∑ API**

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `lang=ru` –≤ VK API –∑–∞–ø—Ä–æ—Å—ã

**–§–∞–π–ª:** `app/vk_oauth.py`

```python
params = {
    'user_ids': resolved_id,
    'fields': 'photo_100,screen_name,contacts',
    'access_token': self.service_token,
    'lang': 'ru',  # ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û! –ü–æ–ª—É—á–∞–µ–º –∏–º–µ–Ω–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
    'v': '5.131'
}
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏–º–µ–Ω –≤ VK –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `app/routers/auth.py`

**–ë—ã–ª–æ:**
```python
# –î–∞–Ω–Ω—ã–µ –∏–∑ SDK –∏–º–µ–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
first_name = user_info["first_name"] or first_name
last_name = user_info["last_name"] or last_name
```

**–°—Ç–∞–ª–æ:**
```python
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–∞–Ω–Ω—ã–º –∏–∑ VK API (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ)
api_first_name = user_info.get("first_name", "").strip()
api_last_name = user_info.get("last_name", "").strip()

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ API –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—É—Å—Ç—ã–µ
if api_first_name:
    first_name = api_first_name
if api_last_name:
    last_name = api_last_name
```

### 3. –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–§–∞–π–ª:** `app/auth.py`

```python
# –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—É—Å—Ç—ã–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä—É—Å—Å–∫–∏–º –∏–º–µ–Ω–∞–º)
if first_name and first_name.strip():
    user.first_name = first_name
if last_name and last_name.strip():
    user.last_name = last_name
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK –ø–æ–ª—É—á–∞—é—Ç—Å—è **—Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞** –∏–∑ VK API
- Fallback –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ VK API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–º–µ–Ω–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è** –Ω–∞ —Ä—É—Å—Å–∫–∏–µ
- –ü—É—Å—Ç—ã–µ –∏–º–µ–Ω–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ VK –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞
2. ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞
3. ‚úÖ Whitelist –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ‚Üí —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∏–∑ VK API
4. ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞

## üîÑ –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª—É—á–∞—Ç —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**

```sql
-- –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
SELECT id, username, first_name, last_name, vk_id 
FROM users 
WHERE vk_id IS NOT NULL 
AND (first_name ~ '^[A-Za-z]+$' OR last_name ~ '^[A-Za-z]+$');
```

## üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `app/vk_oauth.py` - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `lang=ru`
- `app/routers/auth.py` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏–º–µ–Ω
- `app/auth.py` - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéâ –°—Ç–∞—Ç—É—Å

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –≤—Å–µ VK –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞. 